/*
 * hpb_iptitle.js
 * Copyright (c) 2011 Justsystems
 * Version: 1.1 (8/7/2011)
 */
function parse(data,tag_div,config){var info=$(data).find('information');var width=info.attr('width');var height=info.attr('height');var style=tag_div.attr('style').toLowerCase();if(style.indexOf('width')!=-1||style.indexOf('height')!=-1){width=tag_div.width();height=tag_div.height();}tag_div.empty();var base=abspath(config);var append_tag='';$(data).find('image').each(function(){var img=$(this);var img_width=width;var img_height=height;var img_left=0;var img_top=0;var img_right=0;var img_bottom=0;if(info.attr('scale')=='0'){img_width=img.attr('width');img_height=img.attr('height');var x_zoom=img_width/width;var y_zoom=img_height/height;if(x_zoom<1.0&&y_zoom<1.0){img_left=Math.floor((width-img_width)/2);img_top=Math.floor((height-img_height)/2);}else if(x_zoom<y_zoom){img_width=Math.floor(img_width*height/img_height);img_height=height;img_left=Math.floor((width-img_width)/2);}else{img_height=Math.floor(img_height*width/img_width);img_width=width;img_top=Math.floor((height-img_height)/2);}img_right=width-img_width-img_left;img_bottom=height-img_height-img_top;}var tag_img='<img src="'+joinpath(base,img.attr('src'))+'?'+new Date().getTime()+'" width="'+img_width+'" height="'+img_height+'" style="margin: '+img_top+'px '+img_right+'px '+img_bottom+'px '+img_left+'px; padding: 0px;" alt="" border="0"/>';if(img.attr('href').length>0){append_tag='<a href="'+joinpath(base,img.attr('href'))+'" target="'+img.attr('target')+'">'+tag_img+'</a>';}else{append_tag=tag_img;}tag_div.append(append_tag);});if(tag_div.children().size()==1){tag_div.append(append_tag);}var autostop=info.attr('autostop');tag_div.cycle({fx:info.attr('transition'),speed:info.attr('speed'),timeout:info.attr('timeout'),autostop:(info.attr('autostop')>0)?1:0,autostopCount:info.attr('autostop'),pause:(info.attr('pause')==1)?1:0});}function abspath(path){var e=document.createElement('span');e.innerHTML='<a href="'+path+'" />';return e.firstChild.href;}function joinpath(base,path){var regexp=new RegExp('^[a-z][a-z0-9+-.]*://','i');if(path.match(regexp)){return path;}if(base.substr(base.length-1)!='/'){base=base.split('/');base.length--;}else{base=base.substr(0,base.length-1).split('/');}while(0==path.indexOf('../')){base.length--;path=path.substr(3);}return base.join('/')+'/'+path;}function hpbiptitle(config,tag_img){var tag_div=$(tag_img).closest('div');if(tag_div.size()>0&&tag_div.attr('name')=='HPBTITLE'){jQuery.ajax({url:config,type:'GET',dataType:'xml',cache:false,timeout:1000,success:function(data,status,xhr){parse(data,tag_div,config);},error:function(request,tatus,thrown){jQuery.ajax({url:config,dataType:'text',cache:false,timeout:1000,success:function(data,status,xhr){if(data.length!=0){if(window.ActiveXObject){var doc=new ActiveXObject('Microsoft.XMLDOM');doc.async='false';doc.loadXML(data);}else{var parser=new DOMParser();var doc=parser.parseFromString(data,'text/xml');}parse(doc,tag_div,config);}},error:function(request,status,thrown){}});}});}}